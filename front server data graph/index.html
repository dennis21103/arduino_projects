<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title></title>
  <!--<link rel="stylesheet" href="style.css" />-->
</head>
<body>
 <div align="center">My web graphs temp:
  <select name="selector" id="selector" onChange="ReDraw(this.value)">
    <option value="1" >5 min</option>
    <option value="3" selected>15 min</option>
    <option value="6">30 min</option>
    <option value="12">1 hour</option>
    <option value="24">2 hours</option>
    <option value="48">4 hours</option>
    <option value="96">8 hours</option>
    <option value="144">12 hours</option>
    <option value="288">1 day</option>
  </select>
 </div> 
<div id = "canva" ><canvas id="myChart" width="400px" height="400px"></canvas></div> 
<script src="http://127.0.0.1/chart.js"></script>

<script>
var select = document.getElementById("selector");
var time_line = Number(select.value);
</script>


<script>
if ( ! (window.File && window.FileReader && window.FileList && window.Blob)) {
  alert('The File APIs are not fully supported in this browser.');
}
</script>
 
<script>
function everyNth_element(arr,time_line) {
  const result = [];
  for (let i=0; i<arr.length-1; i+=time_line) {
    result[i] = arr[i]; 
  }

  return result;
}  
function X_Axis (file, time_line) { <!--//Date and time line-->
var arr = Array.from(file);
for (let i = 0; i < arr.length-1; i++) 
  {
    arr[i] = arr[i][0] + " " +arr[i][1];
  }
  arr.pop();
  arr = everyNth_element(arr,time_line);
  
  return arr
}

function Y_Axis (file, time_line) { <!--//Temp 5 min avg-->
  var arr = Array.from(file);
  for (let i = 0; i < arr.length-1; i++) 
  {
    arr[i] = arr[i][11];
  }
  arr.pop();
  arr = everyNth_element(arr,time_line);

  return arr
}

function Y1_Axis (file, time_line) { <!--//Hum 5 min avg-->
  var arr = Array.from(file);
  for (let i = 0; i < arr.length-1; i++) 
  {
    arr[i] = arr[i][13];
  }
  arr.pop();
  arr = everyNth_element(arr,time_line);

  return arr
 }

function Y2_Axis (file, time_line) { <!--//CO2 ppm-->
  var arr = Array.from(file);
  for (let i = 0; i < arr.length-1; i++) 
  {
    arr[i] = arr[i][15];
  }
  arr.pop();
  arr = everyNth_element(arr,time_line);

  return arr

}

function String_Slice (allText) {
var textToArray = allText.split("\n").map(function(x){return x.split(";")});
return textToArray
}

function Download_File(file_path) 
{
    var allText = [];
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file_path, false);
    rawFile.onreadystatechange = function (){
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
              allText = rawFile.responseText;
              window.allText = String_Slice(allText);
              
            }
        }
    }
   
    rawFile.send(null);
    <!--// return allText-->
    <!--//alert('problem with file'); //придумать обработку и посмотреть state-->
}

Download_File('temp-service.txt');
const file = window.allText;

</script>

<script>
function Draw (time_line){
const ctx = document.getElementById('myChart');
const myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: X_Axis (file, time_line),
        datasets: [{
            label: 'Temperature C',
            data: Y_Axis (file, time_line),
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
            ],
            borderWidth: 3,
            yAxisID: 'y1',
                  },
                   {
            label: 'Humidity %',
            data: Y1_Axis (file, time_line),
            backgroundColor: [
                'rgba(120, 99, 132, 0.2)',
            ],
            borderColor: [
                'rgba(125, 99, 132, 1)',
            ],
            borderWidth: 3,
            yAxisID: 'y1',
                  },
                  {
            label: 'CO2 ppm',
            data: Y2_Axis (file, time_line),
            backgroundColor: [
                'rgba(185, 231, 132, 0.2)',
            ],
            borderColor: [
                'rgba(185, 231, 132, 1)',
            ],
            borderWidth: 3,
            yAxisID: 'y3',
                  },
                                     ]
    },
    options: {
      responsive: true,
      interaction: {
      mode: 'index',
      intersect: false,
                    },
      stacked: false,
      plugins: {
      title: {
        display: true,
        text: ''
               }
             },
        scales: {
            y1: {
                type:'linear',
                display: true,
                 position: 'left',
                beginAtZero: false,
            },
            y3: {
                type:'linear',
                display: true,
                position: 'right',
                beginAtZero: false,
            },          
        }
    }
});
}
function ReDraw(time_line){
  document.querySelector("#canva").innerHTML = '<canvas id="myChart" width="400px" height="400px"></canvas>';
  time_line = Number(time_line);
  Draw(time_line);
}
Draw(time_line);
</script>

</body>
</html>